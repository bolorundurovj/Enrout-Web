<div class="mt-4 flex flex-col">
  <div class="flex flex-row justify-end items-center mb-4">
    <button (click)="showConfirm()" class="btn btn-secondary">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
           xmlns="http://www.w3.org/2000/svg">
        <path
          d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
          stroke-linecap="round"
          stroke-linejoin="round"/>
      </svg>
      <span class="ml-2">Add Document</span>
    </button>
  </div>
  <div class="relative overflow-x-auto border sm:rounded-lg p-2">
    <div class="flex items-center justify-between pb-4">
      <div>
        <select (change)="getDocs()"
                [(ngModel)]="pagination.take"
                [disabled]="documents.length < 1"
                class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
                id="countries">
          <option>Page Size</option>
          <option *ngFor="let l of limits" [value]="l">{{l}} items</option>
        </select>
      </div>
      <label class="sr-only">Search</label>
      <div class="relative">
        <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
          <svg aria-hidden="true" class="w-5 h-5 text-gray-500 dark:text-gray-400" fill="currentColor"
               viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
            <path clip-rule="evenodd"
                  d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                  fill-rule="evenodd"></path>
          </svg>
        </div>
        <input [disabled]="documents.length < 1"
               class="block p-2 pl-10 text-sm text-gray-900 border border-gray-300 rounded-lg w-80 bg-gray-50 focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
               id="table-search"
               placeholder="Search for items"
               type="text">
      </div>
    </div>
    <table *ngIf="documents.length > 0" class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
      <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
      <tr>
        <th class="px-6 py-3" scope="col">
          Title
        </th>
        <th class="px-6 py-3" scope="col">
          Status
        </th>
        <th class="px-6 py-3" scope="col">
          Stage
        </th>
        <th class="px-6 py-3" scope="col">
          Attachment
        </th>
        <th class="px-6 py-3" scope="col">
          Created
        </th>
        <th class="px-6 py-3" scope="col">
          Last Modified
        </th>
        <th class="px-6 py-3" scope="col">
          Actions
        </th>
      </tr>
      </thead>
      <tbody>
      <tr *ngFor="let d of documents"
          class="bg-white border-b dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
        <th class="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white" scope="row">
          {{d.title}}
        </th>
        <td class="px-6 py-4">
          <span
            [ngClass]="pillColor(d.state)"
            class="text-slate-200 text-xs font-medium mr-2 px-2.5 py-0.5 rounded dark:bg-blue-900 dark:text-blue-300">{{d.state}}</span>
        </td>
        <td class="px-6 py-4">
          {{d.handlers.length}}/{{d?.workflow === null ? 'NA' : 5}}
        </td>
        <td class="px-6 py-4">
          {{d?.attachment === null ? 'NA' : 'View'}}
        </td>
        <td class="px-6 py-4">
          {{d.createdAt | date}}
        </td>
        <td class="px-6 py-4">
          {{d.updatedAt | date}}
        </td>
        <td class="px-6 py-4 flex flex-row">

          <div class="inline-flex rounded-md shadow-sm">
            <button (click)="publishDocument(d)" *ngIf="d?.currentlyAssignedId === null; else nudgeElse;"
                    aria-current="page"
                    class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"
                    type="button">
              <span *ngIf="!isPublishing  || d.id !== doc?.id">Publish</span>
              <app-spinner *ngIf="isPublishing&& d.id === doc?.id"></app-spinner>
            </button>
            <ng-template #nudgeElse>
              <button (click)="sendNudge(d)" *ngIf="d.state !== states.CHANGE_REQUESTED; else resolveElse;"
                      [disabled]="d.state !== states.PENDING"
                      aria-current="page"
                      class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"
                      type="button">
                <span *ngIf="!isNudging || d.id !== doc?.id">Nudge</span>
                <app-spinner *ngIf="isNudging&& d.id === doc?.id"></app-spinner>
              </button>
            </ng-template>
            <ng-template #resolveElse>
              <button (click)="resolveDocument(d)" aria-current="page"
                      class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-l-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"
                      type="button">
                <span *ngIf="!isModifying|| d.id !== doc?.id">Resolve</span>
                <app-spinner *ngIf="isModifying&& d.id === doc?.id"></app-spinner>
              </button>
            </ng-template>
            <button (click)="editDocument(d)" [disabled]="d.state !== states.DRAFT"
                    class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border-t border-b border-gray-200 hover:bg-gray-100 hover:text-green-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"
                    type="button">
              <span *ngIf="!isModifying|| d.id !== doc?.id">Modify</span>
              <app-spinner *ngIf="isModifying&& d.id === doc?.id"></app-spinner>
            </button>
            <button (click)="deleteDoc(d)" [disabled]="d.state !== states.DRAFT || isDeleting"
                    class="px-4 py-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-r-md hover:bg-gray-100 hover:text-red-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-700 dark:border-gray-600 dark:text-white dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-blue-500 dark:focus:text-white"
                    type="button">
              <span *ngIf="!isDeleting|| d.id !== doc?.id">Delete</span>
              <app-spinner *ngIf="isDeleting && d.id === doc?.id"></app-spinner>
            </button>
          </div>
        </td>
      </tr>
      </tbody>
    </table>
    <nav *ngIf="documents.length > 0" aria-label="Table navigation" class="flex items-center justify-between pt-4">
      <span class="text-sm font-normal text-gray-500 dark:text-gray-400">Showing <span
        class="font-semibold text-gray-900 dark:text-white">{{(pagination.take * pagination.page) - pagination.take + 1}}
        -{{(pagination.take * pagination.page) < paginationMeta.itemCount ? (pagination.take * pagination.page) : paginationMeta.itemCount}}</span> of <span
        class="font-semibold text-gray-900 dark:text-white">{{paginationMeta.itemCount}}</span></span>
      <div class="flex items-center">
        <button (click)="previousPage()"
                class="w-full p-4 text-base text-gray-600 bg-white dark:bg-gray-700 dark:text-white border rounded-l-xl hover:bg-gray-100"
                type="button">
          <svg class="" fill="currentColor" height="8" viewBox="0 0 1792 1792" width="9"
               xmlns="http://www.w3.org/2000/svg">
            <path
              d="M1427 301l-531 531 531 531q19 19 19 45t-19 45l-166 166q-19 19-45 19t-45-19l-742-742q-19-19-19-45t19-45l742-742q19-19 45-19t45 19l166 166q19 19 19 45t-19 45z">
            </path>
          </svg>
        </button>
        <button (click)="setPage(p)"
                *ngFor="let p of pages"
                [ngClass]="{'text-indigo-500': p === pagination.page}"
                class="w-full px-4 py-2 text-base text-gray-600 bg-white dark:bg-gray-700 dark:text-white border-t border-b border-r hover:bg-gray-100"
                type="button">
          {{p}}
        </button>
        <button (click)="nextPage()"
                class="w-full p-4 text-base text-gray-600 bg-white dark:bg-gray-700 dark:text-white border-t border-b border-r rounded-r-xl hover:bg-gray-100"
                type="button">
          <svg class="" fill="currentColor" height="8" viewBox="0 0 1792 1792" width="9"
               xmlns="http://www.w3.org/2000/svg">
            <path
              d="M1363 877l-742 742q-19 19-45 19t-45-19l-166-166q-19-19-19-45t19-45l531-531-531-531q-19-19-19-45t19-45l166-166q19-19 45-19t45 19l742 742q19 19 19 45t-19 45z">
            </path>
          </svg>
        </button>
      </div>
    </nav>
    <div *ngIf="documents.length < 1" class="flex flex-col mx-auto mt-6 items-center bg-gray-100 rounded py-8">
      <div class="bg-blue-200 text-blue-500 rounded-full p-8 w-fit mb-4">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
             xmlns="http://www.w3.org/2000/svg">
          <path
            d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
            stroke-linecap="round"
            stroke-linejoin="round"/>
        </svg>
      </div>
      <div class="my-2 font-bold text-xl">You're all caught up</div>
      <p class="my-2">
        You haven't created any documents. Created documents will appear here.
      </p>
      <button (click)="showConfirm()" class="btn btn-secondary mt-4">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
             xmlns="http://www.w3.org/2000/svg">
          <path
            d="M19.5 14.25v-2.625a3.375 3.375 0 00-3.375-3.375h-1.5A1.125 1.125 0 0113.5 7.125v-1.5a3.375 3.375 0 00-3.375-3.375H8.25m3.75 9v6m3-3H9m1.5-12H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 00-9-9z"
            stroke-linecap="round"
            stroke-linejoin="round"/>
        </svg>
        <span class="ml-2">Add Document</span>
      </button>
    </div>
  </div>
</div>

<app-modal [show]="showDialog"
           [title]="formMode === 'resolve' ? 'Resolve Document' : formMode === 'edit' ? 'Edit Document' : 'New Document'">
  <div class="w-1/2 mt-10 mx-auto flex-col bg-white dark:bg-slate-800 dark:text-white p-6 rounded-2xl w-[700px]">
    <div *ngIf="formMode === 'resolve'" class="flex flex-row mb-3 p-3 bg-slate-200 rounded">
      <span class="font-bold">Reviewers Comment:</span>
      <p class="ml-2 text-red-800">{{doc?.reviewerComment}}</p>
    </div>
    <form [formGroup]="docForm" class="text-left">
      <div class="mb-6">
        <label class="block font-bold mb-2 text-sm font-medium text-gray-900 dark:text-white">Title</label>
        <input
          class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
          formControlName="title"
          id="title" placeholder="Enter title" type="text">
      </div>
      <div class="mb-6">
        <label class="block font-bold mb-2 text-sm font-medium text-gray-900 dark:text-white">Description</label>
        <angular-editor [(ngModel)]="description" [placeholder]="'Enter text here...'" class="block"
                        formControlName="description"
                        id="description"></angular-editor>
      </div>
      <div class="flex flex-row justify-end items-center w-full my-2">
        <button (click)="cancel()"
                class="text-white bg-red-700 hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center mr-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800"
                type="button">
          <svg class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"
               xmlns="http://www.w3.org/2000/svg">
            <path
              d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0"
              stroke-linecap="round"
              stroke-linejoin="round"/>
          </svg>

          Cancel
        </button>
        <button (click)="saveDocument()" [disabled]="docForm.invalid || isSaving || isModifying"
                class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center mr-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800 disabled:cursor-not-allowed"
                type="button">
          <svg *ngIf="!isSaving && !isModifying" class="w-5 h-5 mr-2 -ml-1" fill="none" stroke="currentColor"
               stroke-width="1.5" viewBox="0 0 24 24"
               xmlns="http://www.w3.org/2000/svg">
            <path d="M12 4.5v15m7.5-7.5h-15" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <app-spinner *ngIf="isModifying || isSaving"></app-spinner>

          Save
        </button>
      </div>
    </form>
  </div>

</app-modal>
